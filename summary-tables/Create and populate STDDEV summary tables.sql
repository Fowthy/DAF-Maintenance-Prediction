-- Drop tables if they exist
DROP TABLE IF EXISTS STDDEV_SUMMARY_A11_A1;
DROP TABLE IF EXISTS STDDEV_SUMMARY_A2_Z;
DROP TABLE IF EXISTS STDDEV_SUMMARY_W_Q1;
DROP TABLE IF EXISTS STDDEV_SUMMARY_X_Y;
DROP TABLE IF EXISTS STDDEV_SUMMARY_C_B;

-- Create STDDEV summary tables
CREATE TABLE STDDEV_SUMMARY_A11_A1
(
`BFC_TIMESTAMP` DATETIME(6) NOT NULL,
`BFC_SOURCE_ID` SMALLINT UNSIGNED NOT NULL,
`DATAPOINT_A11_Position` FLOAT DEFAULT NULL,
`DATAPOINT_A11_Current` FLOAT DEFAULT NULL,
`DATAPOINT_A11_DevPos` FLOAT DEFAULT NULL,
`DATAPOINT_A1_Position` FLOAT DEFAULT NULL,
`DATAPOINT_A1_Current` FLOAT DEFAULT NULL,
PRIMARY KEY (`BFC_TIMESTAMP`, `BFC_SOURCE_ID`)
);

CREATE TABLE STDDEV_SUMMARY_A2_Z
(
`BFC_TIMESTAMP` DATETIME(6) NOT NULL,
`BFC_SOURCE_ID` SMALLINT UNSIGNED NOT NULL,
`DATAPOINT_A2_Position` FLOAT DEFAULT NULL,
`DATAPOINT_A2_Current` FLOAT DEFAULT NULL,
`DATAPOINT_A2_PosDev` FLOAT DEFAULT NULL,
`DATAPOINT_Z_Position` FLOAT DEFAULT NULL,
`DATAPOINT_Z_Current` FLOAT DEFAULT NULL,
`DATAPOINT_Z_PosDev` FLOAT DEFAULT NULL,
`DATAPOINT_Z_Lag` FLOAT DEFAULT NULL,
`DATAPOINT_Z_ControlDev` FLOAT DEFAULT NULL,
`DATAPOINT_Z_ContourDev` FLOAT DEFAULT NULL,
PRIMARY KEY (`BFC_TIMESTAMP`, `BFC_SOURCE_ID`)
);

CREATE TABLE STDDEV_SUMMARY_W_Q1
(
`BFC_TIMESTAMP` DATETIME(6) NOT NULL,
`BFC_SOURCE_ID` SMALLINT UNSIGNED NOT NULL,
`DATAPOINT_W_Position` FLOAT DEFAULT NULL,
`DATAPOINT_W_Current` FLOAT DEFAULT NULL,
`DATAPOINT_W_PosDev` FLOAT DEFAULT NULL,
`DATAPOINT_Q1_Position` FLOAT DEFAULT NULL,
`DATAPOINT_Q1_Current` FLOAT DEFAULT NULL,
`DATAPOINT_Q1_PosDev` FLOAT DEFAULT NULL,
PRIMARY KEY (`BFC_TIMESTAMP`, `BFC_SOURCE_ID`)
);

CREATE TABLE STDDEV_SUMMARY_X_Y
(
`BFC_TIMESTAMP` DATETIME(6) NOT NULL,
`BFC_SOURCE_ID` SMALLINT UNSIGNED NOT NULL,
`DATAPOINT_X_Position` FLOAT DEFAULT NULL,
`DATAPOINT_X_Current` FLOAT DEFAULT NULL,
`DATAPOINT_X_PosDev` FLOAT DEFAULT NULL,
`DATAPOINT_X_Lag` FLOAT DEFAULT NULL,
`DATAPOINT_X_ControlDev` FLOAT DEFAULT NULL,
`DATAPOINT_X_DontourDev` FLOAT DEFAULT NULL,
`DATAPOINT_Y_Position` FLOAT DEFAULT NULL,
`DATAPOINT_Y_Current` FLOAT DEFAULT NULL,
`DATAPOINT_Y_PosDev` FLOAT DEFAULT NULL,
  PRIMARY KEY (`BFC_TIMESTAMP`, `BFC_SOURCE_ID`)
);

CREATE TABLE STDDEV_SUMMARY_C_B
(
`BFC_TIMESTAMP` DATETIME(6) NOT NULL,
`BFC_SOURCE_ID` SMALLINT UNSIGNED NOT NULL,
`DATAPOINT_C_Position` FLOAT DEFAULT NULL,
`DATAPOINT_C_Current` FLOAT DEFAULT NULL,
`DATAPOINT_B_Position` FLOAT DEFAULT NULL,
`DATAPOINT_B_Current` FLOAT DEFAULT NULL,
`DATAPOINT_B_PosDev` FLOAT DEFAULT NULL,
  PRIMARY KEY (`BFC_TIMESTAMP`, `BFC_SOURCE_ID`)
);

-- Populate STDDEV summary tables
INSERT INTO STDDEV_SUMMARY_C_B (BFC_TIMESTAMP, BFC_SOURCE_ID, DATAPOINT_C_Position, DATAPOINT_C_Current, DATAPOINT_B_Position, DATAPOINT_B_Current, DATAPOINT_B_PosDev)
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(BFC_TIMESTAMP) DIV 60 * 60) as time,
BFC_SOURCE_ID,
STDDEV(DATAPOINT_C_Position),
STDDEV(DATAPOINT_C_Current),
STDDEV(DATAPOINT_B_Position),
STDDEV(DATAPOINT_B_Current),
STDDEV(DATAPOINT_B_PosDev)
FROM DATASET_C_Axis_B_Axis
GROUP BY time, BFC_SOURCE_ID
ORDER BY time;

INSERT INTO STDDEV_SUMMARY_X_Y (BFC_TIMESTAMP, BFC_SOURCE_ID, DATAPOINT_X_Position, DATAPOINT_X_Current, DATAPOINT_X_PosDev, DATAPOINT_X_Lag, DATAPOINT_X_ControlDev, DATAPOINT_X_DontourDev, DATAPOINT_Y_Position, DATAPOINT_Y_Current, DATAPOINT_Y_PosDev)
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(BFC_TIMESTAMP) DIV 60 * 60) as time,
BFC_SOURCE_ID,
STDDEV(DATAPOINT_X_Position),
STDDEV(DATAPOINT_X_Current),
STDDEV(DATAPOINT_X_PosDev),
STDDEV(DATAPOINT_X_Lag),
STDDEV(DATAPOINT_X_ControlDev),
STDDEV(DATAPOINT_X_ContourDev),
STDDEV(DATAPOINT_Y_Position),
STDDEV(DATAPOINT_Y_Current),
STDDEV(DATAPOINT_Y_PosDev)
FROM DATASET_X_Axis_Y_Axis
GROUP BY time, BFC_SOURCE_ID
ORDER BY time;

INSERT INTO STDDEV_SUMMARY_W_Q1 (BFC_TIMESTAMP, BFC_SOURCE_ID, DATAPOINT_W_Position, DATAPOINT_W_Current, DATAPOINT_W_PosDev, DATAPOINT_Q1_Position, DATAPOINT_Q1_Current, DATAPOINT_Q1_PosDev)
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(BFC_TIMESTAMP) DIV 60 * 60) as time,
BFC_SOURCE_ID,
STDDEV(DATAPOINT_W_Position),
STDDEV(DATAPOINT_W_Current),
STDDEV(DATAPOINT_W_PosDev),
STDDEV(DATAPOINT_Q1_Position),
STDDEV(DATAPOINT_Q1_Current),
STDDEV(DATAPOINT_Q1_PosDev)
FROM DATASET_W_Axis_Q1_Axis
GROUP BY time, BFC_SOURCE_ID
ORDER BY time;

INSERT INTO STDDEV_SUMMARY_A2_Z (BFC_TIMESTAMP, BFC_SOURCE_ID, DATAPOINT_A2_Position, DATAPOINT_A2_Current, DATAPOINT_A2_PosDev, DATAPOINT_Z_Position, DATAPOINT_Z_Current, DATAPOINT_Z_PosDev, DATAPOINT_Z_Lag, DATAPOINT_Z_ControlDev, DATAPOINT_Z_ContourDev)
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(BFC_TIMESTAMP) DIV 60 * 60) as time,
BFC_SOURCE_ID,
STDDEV(DATAPOINT_A2_Position),
STDDEV(DATAPOINT_A2_Current),
STDDEV(DATAPOINT_A2_PosDev),
STDDEV(DATAPOINT_Z_Position),
STDDEV(DATAPOINT_Z_Current),
STDDEV(DATAPOINT_Z_PosDev),
STDDEV(DATAPOINT_Z_Lag),
STDDEV(DATAPOINT_Z_ControlDev),
STDDEV(DATAPOINT_Z_ContourDev)
FROM DATASET_A2_Axis_Z_Axis
GROUP BY time, BFC_SOURCE_ID
ORDER BY time;

INSERT INTO STDDEV_SUMMARY_A11_A1 (BFC_TIMESTAMP, BFC_SOURCE_ID, DATAPOINT_A11_Position, DATAPOINT_A11_Current, DATAPOINT_A11_DevPos, DATAPOINT_A1_Position, DATAPOINT_A1_Current)
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(BFC_TIMESTAMP) DIV 60 * 60) as time,
BFC_SOURCE_ID,
STDDEV(DATAPOINT_A11_Position),
STDDEV(DATAPOINT_A11_Current),
STDDEV(DATAPOINT_A11_DevPos),
STDDEV(DATAPOINT_A1_Position),
STDDEV(DATAPOINT_A1_Current)
FROM DATASET_A11_Axis_A1_Axis
GROUP BY time, BFC_SOURCE_ID
ORDER BY time;